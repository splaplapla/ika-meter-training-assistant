<script>
jcrop = Jcrop.attach('target_dataset', {
  multiMin: 0,
  multi: true
})

function loadJcrop(points) {
  const options = {};
  let rect = null; 

  points.forEach(function(point) {
    jcrop.newWidget(
      Jcrop.Rect.create(point.x, point.y, point.width, point.height),
      options
    );
  })
};

function saveCrops() {
  const positionParams = Array.from(jcrop.crops).map(function(crop) {
      return [crop.pos.x, crop.pos.y, crop.pos.w, crop.pos.h]
  })
  const path = '<%= "/datasets/#{@dataset.id}/dataset_positions" %>'
  const XHR = new XMLHttpRequest(), fd = new FormData();
  fd.append("positions", positionParams)
  XHR.addEventListener('load', function(event) {
    alert('Yeah! Data sent and response loaded.');
  });
  XHR.addEventListener('error', function(event) {
    alert('Oups! Something goes wrong.');
  });
  XHR.open('POST', path);
  XHR.send(fd);
  return true;
}
</script>
